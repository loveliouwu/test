## AEAD 认证加密
Authenticated Encryption with Associated Data (AEAD) 是一种同时具备保密性，完整性和可认证性的加密形式。 

AEAD产生的原因很简单，单纯的对称加密算法，其解密步骤是无法确认密钥是否正确的，也就是说，加密后的数据可以用任何密钥进行解密运算，得到一组疑似原始数据，而不知道密钥是否是正确的，也不知道解密出来的原始数据是否正确。 

因此，需要在单纯的加密算法之上，加上一层验证手段。简单的把加密算法和认证算法组合，可以实现该目的。

- 第一种方案：  
先加密，然后对密文进行MAC运算，一般用各种HMAC，把二者拼接起来，发送给接收方，接收方先验证MAC，如果验证通过，则证明密钥是正确的，然后执行解密运算。

- 第二种方案： 
同时对原始数据执行加密和MAC运算，把二者拼接起来，发送给接收方，接收方先解密，然后对解密结果执行MAC运算，对比发来的MAC，验证正确性。 

- 第三种方案： 
先对原始数据执行MAC运算，与原始数据拼接后，执行加密算法，将密文发送给接收方。接收方先进行解密，然后执行MAC运算，验证解密结果是否正确。然而，业内逐渐意识到以上通过组合加密和认证算法实现AEAD的方案都是有安全问题的。

因此需要一个算法内部同时实现加密和认证。基于这个思想，一些新的算法被提出，这些算法被称为真正的AEAD算法。 
常见的AEAD算法如下： 
```C
AES-128-GCM
AES-192-GCM
AES-256-GCM
ChaCha20-IETF-Poly1305
XChaCha20-IETF-Poly1305
```
在具备AES加速的CPU上，建议使用AES-XXX-GCM系列，移动设备建议使用ChaCha20-IETF-Poly1305系列。 

- AEAD的实现步骤： 
1. 通过密钥key对消息进行加密，通过增加随机数来保证隐私。 
2.计算一个认证标签，通过该认证标签可保证一条消息中加密和未加密的部分均未被篡改。



## HMAC 
密钥散列消息认证码(Keyed-hash message authentication code)又称散列消息认证码，是一种通过特别计算方式之后产生的消息认证码(MAC)，使用密码散列函数，同时结合一个加密密钥，它可以用来保证数据的完整性，同时可以用来作某个消息的身份验证。 

### 定义 
opad是外部填充(0x5c5c5c...5c5c，一段十六进制的常量) 
ipad是内部填充(0x363636...3636，一段十六进制的常量) 
在HMAC的定义中用到一个密码散列函数H和一个密钥K，假设H是一个能够对明文进行分组循环压缩的散列函数，B为散列函数的明文分组长度，在上述的散列函数中B=64，L为散列函数的输出长度，MD5中L=16，SHA-1中的L=20，认证密钥K可以为任意长度，一般密钥长度应大于明文分组的长度，将密钥的第一次散列值作为HMAC真正使用的密钥，密钥的最小推荐长度为Lbytes.

若以“text”作为要计算HMAC的明文，则作如下操作：
H（K XOR opad，H（K XOR ipad，text））

- 算法密钥 
HMAC运算利用hash算法，以一个消息M和一个密钥K作为输入，生成一个定长的消息摘要作为输出，HMAC算法利用已有的hash函数。 
HMAC的密钥长度可以是任意大小，如果小于n（hash输出值的大小），那么将会消弱算法安全的强度。



### 序列密码（流密码） 
它是对称密码算法的一种，序列密码具有实现简单、便于硬件实施、加解密处理速度快、没有或只有有限的错误传播等特点。